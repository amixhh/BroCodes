"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
exports.id = "vendor-chunks/y-websocket";
exports.ids = ["vendor-chunks/y-websocket"];
exports.modules = {

/***/ "(ssr)/./node_modules/y-websocket/src/y-websocket.js":
/*!*****************************************************!*\
  !*** ./node_modules/y-websocket/src/y-websocket.js ***!
  \*****************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   WebsocketProvider: () => (/* binding */ WebsocketProvider),\n/* harmony export */   messageAuth: () => (/* binding */ messageAuth),\n/* harmony export */   messageAwareness: () => (/* binding */ messageAwareness),\n/* harmony export */   messageQueryAwareness: () => (/* binding */ messageQueryAwareness),\n/* harmony export */   messageSync: () => (/* binding */ messageSync)\n/* harmony export */ });\n/* harmony import */ var lib0_broadcastchannel__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! lib0/broadcastchannel */ \"(ssr)/./node_modules/lib0/broadcastchannel.js\");\n/* harmony import */ var lib0_time__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! lib0/time */ \"(ssr)/./node_modules/lib0/time.js\");\n/* harmony import */ var lib0_encoding__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! lib0/encoding */ \"(ssr)/./node_modules/lib0/encoding.js\");\n/* harmony import */ var lib0_decoding__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! lib0/decoding */ \"(ssr)/./node_modules/lib0/decoding.js\");\n/* harmony import */ var y_protocols_sync__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! y-protocols/sync */ \"(ssr)/./node_modules/y-protocols/sync.js\");\n/* harmony import */ var y_protocols_auth__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! y-protocols/auth */ \"(ssr)/./node_modules/y-protocols/auth.js\");\n/* harmony import */ var y_protocols_awareness__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! y-protocols/awareness */ \"(ssr)/./node_modules/y-protocols/awareness.js\");\n/* harmony import */ var lib0_observable__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! lib0/observable */ \"(ssr)/./node_modules/lib0/observable.js\");\n/* harmony import */ var lib0_math__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! lib0/math */ \"(ssr)/./node_modules/lib0/math.js\");\n/* harmony import */ var lib0_url__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! lib0/url */ \"(ssr)/./node_modules/lib0/url.js\");\n/* harmony import */ var lib0_environment__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! lib0/environment */ \"(ssr)/./node_modules/lib0/environment.js\");\n/**\n * @module provider/websocket\n */\n\n/* eslint-env browser */\n\n // eslint-disable-line\n\n\n\n\n\n\n\n\n\n\n\n\nconst messageSync = 0\nconst messageQueryAwareness = 3\nconst messageAwareness = 1\nconst messageAuth = 2\n\n/**\n *                       encoder,          decoder,          provider,          emitSynced, messageType\n * @type {Array<function(encoding.Encoder, decoding.Decoder, WebsocketProvider, boolean,    number):void>}\n */\nconst messageHandlers = []\n\nmessageHandlers[messageSync] = (\n  encoder,\n  decoder,\n  provider,\n  emitSynced,\n  _messageType\n) => {\n  lib0_encoding__WEBPACK_IMPORTED_MODULE_3__.writeVarUint(encoder, messageSync)\n  const syncMessageType = y_protocols_sync__WEBPACK_IMPORTED_MODULE_0__.readSyncMessage(\n    decoder,\n    encoder,\n    provider.doc,\n    provider\n  )\n  if (\n    emitSynced && syncMessageType === y_protocols_sync__WEBPACK_IMPORTED_MODULE_0__.messageYjsSyncStep2 &&\n    !provider.synced\n  ) {\n    provider.synced = true\n  }\n}\n\nmessageHandlers[messageQueryAwareness] = (\n  encoder,\n  _decoder,\n  provider,\n  _emitSynced,\n  _messageType\n) => {\n  lib0_encoding__WEBPACK_IMPORTED_MODULE_3__.writeVarUint(encoder, messageAwareness)\n  lib0_encoding__WEBPACK_IMPORTED_MODULE_3__.writeVarUint8Array(\n    encoder,\n    y_protocols_awareness__WEBPACK_IMPORTED_MODULE_2__.encodeAwarenessUpdate(\n      provider.awareness,\n      Array.from(provider.awareness.getStates().keys())\n    )\n  )\n}\n\nmessageHandlers[messageAwareness] = (\n  _encoder,\n  decoder,\n  provider,\n  _emitSynced,\n  _messageType\n) => {\n  y_protocols_awareness__WEBPACK_IMPORTED_MODULE_2__.applyAwarenessUpdate(\n    provider.awareness,\n    lib0_decoding__WEBPACK_IMPORTED_MODULE_4__.readVarUint8Array(decoder),\n    provider\n  )\n}\n\nmessageHandlers[messageAuth] = (\n  _encoder,\n  decoder,\n  provider,\n  _emitSynced,\n  _messageType\n) => {\n  y_protocols_auth__WEBPACK_IMPORTED_MODULE_1__.readAuthMessage(\n    decoder,\n    provider.doc,\n    (_ydoc, reason) => permissionDeniedHandler(provider, reason)\n  )\n}\n\n// @todo - this should depend on awareness.outdatedTime\nconst messageReconnectTimeout = 30000\n\n/**\n * @param {WebsocketProvider} provider\n * @param {string} reason\n */\nconst permissionDeniedHandler = (provider, reason) =>\n  console.warn(`Permission denied to access ${provider.url}.\\n${reason}`)\n\n/**\n * @param {WebsocketProvider} provider\n * @param {Uint8Array} buf\n * @param {boolean} emitSynced\n * @return {encoding.Encoder}\n */\nconst readMessage = (provider, buf, emitSynced) => {\n  const decoder = lib0_decoding__WEBPACK_IMPORTED_MODULE_4__.createDecoder(buf)\n  const encoder = lib0_encoding__WEBPACK_IMPORTED_MODULE_3__.createEncoder()\n  const messageType = lib0_decoding__WEBPACK_IMPORTED_MODULE_4__.readVarUint(decoder)\n  const messageHandler = provider.messageHandlers[messageType]\n  if (/** @type {any} */ (messageHandler)) {\n    messageHandler(encoder, decoder, provider, emitSynced, messageType)\n  } else {\n    console.error('Unable to compute message')\n  }\n  return encoder\n}\n\n/**\n * Outsource this function so that a new websocket connection is created immediately.\n * I suspect that the `ws.onclose` event is not always fired if there are network issues.\n *\n * @param {WebsocketProvider} provider\n * @param {WebSocket} ws\n * @param {CloseEvent | null} event\n */\nconst closeWebsocketConnection = (provider, ws, event) => {\n  if (ws === provider.ws) {\n    provider.emit('connection-close', [event, provider])\n    provider.ws = null\n    ws.close()\n    provider.wsconnecting = false\n    if (provider.wsconnected) {\n      provider.wsconnected = false\n      provider.synced = false\n      // update awareness (all users except local left)\n      y_protocols_awareness__WEBPACK_IMPORTED_MODULE_2__.removeAwarenessStates(\n        provider.awareness,\n        Array.from(provider.awareness.getStates().keys()).filter((client) =>\n          client !== provider.doc.clientID\n        ),\n        provider\n      )\n      provider.emit('status', [{\n        status: 'disconnected'\n      }])\n    } else {\n      provider.wsUnsuccessfulReconnects++\n    }\n    // Start with no reconnect timeout and increase timeout by\n    // using exponential backoff starting with 100ms\n    setTimeout(\n      setupWS,\n      lib0_math__WEBPACK_IMPORTED_MODULE_5__.min(\n        lib0_math__WEBPACK_IMPORTED_MODULE_5__.pow(2, provider.wsUnsuccessfulReconnects) * 100,\n        provider.maxBackoffTime\n      ),\n      provider\n    )\n  }\n}\n\n/**\n * @param {WebsocketProvider} provider\n */\nconst setupWS = (provider) => {\n  if (provider.shouldConnect && provider.ws === null) {\n    const websocket = new provider._WS(provider.url, provider.protocols)\n    websocket.binaryType = 'arraybuffer'\n    provider.ws = websocket\n    provider.wsconnecting = true\n    provider.wsconnected = false\n    provider.synced = false\n\n    websocket.onmessage = (event) => {\n      provider.wsLastMessageReceived = lib0_time__WEBPACK_IMPORTED_MODULE_6__.getUnixTime()\n      const encoder = readMessage(provider, new Uint8Array(event.data), true)\n      if (lib0_encoding__WEBPACK_IMPORTED_MODULE_3__.length(encoder) > 1) {\n        websocket.send(lib0_encoding__WEBPACK_IMPORTED_MODULE_3__.toUint8Array(encoder))\n      }\n    }\n    websocket.onerror = (event) => {\n      provider.emit('connection-error', [event, provider])\n    }\n    websocket.onclose = (event) => {\n      closeWebsocketConnection(provider, websocket, event)\n    }\n    websocket.onopen = () => {\n      provider.wsLastMessageReceived = lib0_time__WEBPACK_IMPORTED_MODULE_6__.getUnixTime()\n      provider.wsconnecting = false\n      provider.wsconnected = true\n      provider.wsUnsuccessfulReconnects = 0\n      provider.emit('status', [{\n        status: 'connected'\n      }])\n      // always send sync step 1 when connected\n      const encoder = lib0_encoding__WEBPACK_IMPORTED_MODULE_3__.createEncoder()\n      lib0_encoding__WEBPACK_IMPORTED_MODULE_3__.writeVarUint(encoder, messageSync)\n      y_protocols_sync__WEBPACK_IMPORTED_MODULE_0__.writeSyncStep1(encoder, provider.doc)\n      websocket.send(lib0_encoding__WEBPACK_IMPORTED_MODULE_3__.toUint8Array(encoder))\n      // broadcast local awareness state\n      if (provider.awareness.getLocalState() !== null) {\n        const encoderAwarenessState = lib0_encoding__WEBPACK_IMPORTED_MODULE_3__.createEncoder()\n        lib0_encoding__WEBPACK_IMPORTED_MODULE_3__.writeVarUint(encoderAwarenessState, messageAwareness)\n        lib0_encoding__WEBPACK_IMPORTED_MODULE_3__.writeVarUint8Array(\n          encoderAwarenessState,\n          y_protocols_awareness__WEBPACK_IMPORTED_MODULE_2__.encodeAwarenessUpdate(provider.awareness, [\n            provider.doc.clientID\n          ])\n        )\n        websocket.send(lib0_encoding__WEBPACK_IMPORTED_MODULE_3__.toUint8Array(encoderAwarenessState))\n      }\n    }\n    provider.emit('status', [{\n      status: 'connecting'\n    }])\n  }\n}\n\n/**\n * @param {WebsocketProvider} provider\n * @param {ArrayBuffer} buf\n */\nconst broadcastMessage = (provider, buf) => {\n  const ws = provider.ws\n  if (provider.wsconnected && ws && ws.readyState === ws.OPEN) {\n    ws.send(buf)\n  }\n  if (provider.bcconnected) {\n    lib0_broadcastchannel__WEBPACK_IMPORTED_MODULE_7__.publish(provider.bcChannel, buf, provider)\n  }\n}\n\n/**\n * Websocket Provider for Yjs. Creates a websocket connection to sync the shared document.\n * The document name is attached to the provided url. I.e. the following example\n * creates a websocket connection to http://localhost:1234/my-document-name\n *\n * @example\n *   import * as Y from 'yjs'\n *   import { WebsocketProvider } from 'y-websocket'\n *   const doc = new Y.Doc()\n *   const provider = new WebsocketProvider('http://localhost:1234', 'my-document-name', doc)\n *\n * @extends {ObservableV2<{ 'connection-close': (event: CloseEvent | null,  provider: WebsocketProvider) => any, 'status': (event: { status: 'connected' | 'disconnected' | 'connecting' }) => any, 'connection-error': (event: Event, provider: WebsocketProvider) => any, 'sync': (state: boolean) => any }>}\n */\nclass WebsocketProvider extends lib0_observable__WEBPACK_IMPORTED_MODULE_8__.ObservableV2 {\n  /**\n   * @param {string} serverUrl\n   * @param {string} roomname\n   * @param {Y.Doc} doc\n   * @param {object} opts\n   * @param {boolean} [opts.connect]\n   * @param {awarenessProtocol.Awareness} [opts.awareness]\n   * @param {Object<string,string>} [opts.params] specify url parameters\n   * @param {Array<string>} [opts.protocols] specify websocket protocols\n   * @param {typeof WebSocket} [opts.WebSocketPolyfill] Optionall provide a WebSocket polyfill\n   * @param {number} [opts.resyncInterval] Request server state every `resyncInterval` milliseconds\n   * @param {number} [opts.maxBackoffTime] Maximum amount of time to wait before trying to reconnect (we try to reconnect using exponential backoff)\n   * @param {boolean} [opts.disableBc] Disable cross-tab BroadcastChannel communication\n   */\n  constructor (serverUrl, roomname, doc, {\n    connect = true,\n    awareness = new y_protocols_awareness__WEBPACK_IMPORTED_MODULE_2__.Awareness(doc),\n    params = {},\n    protocols = [],\n    WebSocketPolyfill = WebSocket,\n    resyncInterval = -1,\n    maxBackoffTime = 2500,\n    disableBc = false\n  } = {}) {\n    super()\n    // ensure that url is always ends with /\n    while (serverUrl[serverUrl.length - 1] === '/') {\n      serverUrl = serverUrl.slice(0, serverUrl.length - 1)\n    }\n    this.serverUrl = serverUrl\n    this.bcChannel = serverUrl + '/' + roomname\n    this.maxBackoffTime = maxBackoffTime\n    /**\n     * The specified url parameters. This can be safely updated. The changed parameters will be used\n     * when a new connection is established.\n     * @type {Object<string,string>}\n     */\n    this.params = params\n    this.protocols = protocols\n    this.roomname = roomname\n    this.doc = doc\n    this._WS = WebSocketPolyfill\n    this.awareness = awareness\n    this.wsconnected = false\n    this.wsconnecting = false\n    this.bcconnected = false\n    this.disableBc = disableBc\n    this.wsUnsuccessfulReconnects = 0\n    this.messageHandlers = messageHandlers.slice()\n    /**\n     * @type {boolean}\n     */\n    this._synced = false\n    /**\n     * @type {WebSocket?}\n     */\n    this.ws = null\n    this.wsLastMessageReceived = 0\n    /**\n     * Whether to connect to other peers or not\n     * @type {boolean}\n     */\n    this.shouldConnect = connect\n\n    /**\n     * @type {number}\n     */\n    this._resyncInterval = 0\n    if (resyncInterval > 0) {\n      this._resyncInterval = /** @type {any} */ (setInterval(() => {\n        if (this.ws && this.ws.readyState === WebSocket.OPEN) {\n          // resend sync step 1\n          const encoder = lib0_encoding__WEBPACK_IMPORTED_MODULE_3__.createEncoder()\n          lib0_encoding__WEBPACK_IMPORTED_MODULE_3__.writeVarUint(encoder, messageSync)\n          y_protocols_sync__WEBPACK_IMPORTED_MODULE_0__.writeSyncStep1(encoder, doc)\n          this.ws.send(lib0_encoding__WEBPACK_IMPORTED_MODULE_3__.toUint8Array(encoder))\n        }\n      }, resyncInterval))\n    }\n\n    /**\n     * @param {ArrayBuffer} data\n     * @param {any} origin\n     */\n    this._bcSubscriber = (data, origin) => {\n      if (origin !== this) {\n        const encoder = readMessage(this, new Uint8Array(data), false)\n        if (lib0_encoding__WEBPACK_IMPORTED_MODULE_3__.length(encoder) > 1) {\n          lib0_broadcastchannel__WEBPACK_IMPORTED_MODULE_7__.publish(this.bcChannel, lib0_encoding__WEBPACK_IMPORTED_MODULE_3__.toUint8Array(encoder), this)\n        }\n      }\n    }\n    /**\n     * Listens to Yjs updates and sends them to remote peers (ws and broadcastchannel)\n     * @param {Uint8Array} update\n     * @param {any} origin\n     */\n    this._updateHandler = (update, origin) => {\n      if (origin !== this) {\n        const encoder = lib0_encoding__WEBPACK_IMPORTED_MODULE_3__.createEncoder()\n        lib0_encoding__WEBPACK_IMPORTED_MODULE_3__.writeVarUint(encoder, messageSync)\n        y_protocols_sync__WEBPACK_IMPORTED_MODULE_0__.writeUpdate(encoder, update)\n        broadcastMessage(this, lib0_encoding__WEBPACK_IMPORTED_MODULE_3__.toUint8Array(encoder))\n      }\n    }\n    this.doc.on('update', this._updateHandler)\n    /**\n     * @param {any} changed\n     * @param {any} _origin\n     */\n    this._awarenessUpdateHandler = ({ added, updated, removed }, _origin) => {\n      const changedClients = added.concat(updated).concat(removed)\n      const encoder = lib0_encoding__WEBPACK_IMPORTED_MODULE_3__.createEncoder()\n      lib0_encoding__WEBPACK_IMPORTED_MODULE_3__.writeVarUint(encoder, messageAwareness)\n      lib0_encoding__WEBPACK_IMPORTED_MODULE_3__.writeVarUint8Array(\n        encoder,\n        y_protocols_awareness__WEBPACK_IMPORTED_MODULE_2__.encodeAwarenessUpdate(awareness, changedClients)\n      )\n      broadcastMessage(this, lib0_encoding__WEBPACK_IMPORTED_MODULE_3__.toUint8Array(encoder))\n    }\n    this._exitHandler = () => {\n      y_protocols_awareness__WEBPACK_IMPORTED_MODULE_2__.removeAwarenessStates(\n        this.awareness,\n        [doc.clientID],\n        'app closed'\n      )\n    }\n    if (lib0_environment__WEBPACK_IMPORTED_MODULE_9__.isNode && typeof process !== 'undefined') {\n      process.on('exit', this._exitHandler)\n    }\n    awareness.on('update', this._awarenessUpdateHandler)\n    this._checkInterval = /** @type {any} */ (setInterval(() => {\n      if (\n        this.wsconnected &&\n        messageReconnectTimeout <\n          lib0_time__WEBPACK_IMPORTED_MODULE_6__.getUnixTime() - this.wsLastMessageReceived\n      ) {\n        // no message received in a long time - not even your own awareness\n        // updates (which are updated every 15 seconds)\n        closeWebsocketConnection(this, /** @type {WebSocket} */ (this.ws), null)\n      }\n    }, messageReconnectTimeout / 10))\n    if (connect) {\n      this.connect()\n    }\n  }\n\n  get url () {\n    const encodedParams = lib0_url__WEBPACK_IMPORTED_MODULE_10__.encodeQueryParams(this.params)\n    return this.serverUrl + '/' + this.roomname +\n      (encodedParams.length === 0 ? '' : '?' + encodedParams)\n  }\n\n  /**\n   * @type {boolean}\n   */\n  get synced () {\n    return this._synced\n  }\n\n  set synced (state) {\n    if (this._synced !== state) {\n      this._synced = state\n      // @ts-ignore\n      this.emit('synced', [state])\n      this.emit('sync', [state])\n    }\n  }\n\n  destroy () {\n    if (this._resyncInterval !== 0) {\n      clearInterval(this._resyncInterval)\n    }\n    clearInterval(this._checkInterval)\n    this.disconnect()\n    if (lib0_environment__WEBPACK_IMPORTED_MODULE_9__.isNode && typeof process !== 'undefined') {\n      process.off('exit', this._exitHandler)\n    }\n    this.awareness.off('update', this._awarenessUpdateHandler)\n    this.doc.off('update', this._updateHandler)\n    super.destroy()\n  }\n\n  connectBc () {\n    if (this.disableBc) {\n      return\n    }\n    if (!this.bcconnected) {\n      lib0_broadcastchannel__WEBPACK_IMPORTED_MODULE_7__.subscribe(this.bcChannel, this._bcSubscriber)\n      this.bcconnected = true\n    }\n    // send sync step1 to bc\n    // write sync step 1\n    const encoderSync = lib0_encoding__WEBPACK_IMPORTED_MODULE_3__.createEncoder()\n    lib0_encoding__WEBPACK_IMPORTED_MODULE_3__.writeVarUint(encoderSync, messageSync)\n    y_protocols_sync__WEBPACK_IMPORTED_MODULE_0__.writeSyncStep1(encoderSync, this.doc)\n    lib0_broadcastchannel__WEBPACK_IMPORTED_MODULE_7__.publish(this.bcChannel, lib0_encoding__WEBPACK_IMPORTED_MODULE_3__.toUint8Array(encoderSync), this)\n    // broadcast local state\n    const encoderState = lib0_encoding__WEBPACK_IMPORTED_MODULE_3__.createEncoder()\n    lib0_encoding__WEBPACK_IMPORTED_MODULE_3__.writeVarUint(encoderState, messageSync)\n    y_protocols_sync__WEBPACK_IMPORTED_MODULE_0__.writeSyncStep2(encoderState, this.doc)\n    lib0_broadcastchannel__WEBPACK_IMPORTED_MODULE_7__.publish(this.bcChannel, lib0_encoding__WEBPACK_IMPORTED_MODULE_3__.toUint8Array(encoderState), this)\n    // write queryAwareness\n    const encoderAwarenessQuery = lib0_encoding__WEBPACK_IMPORTED_MODULE_3__.createEncoder()\n    lib0_encoding__WEBPACK_IMPORTED_MODULE_3__.writeVarUint(encoderAwarenessQuery, messageQueryAwareness)\n    lib0_broadcastchannel__WEBPACK_IMPORTED_MODULE_7__.publish(\n      this.bcChannel,\n      lib0_encoding__WEBPACK_IMPORTED_MODULE_3__.toUint8Array(encoderAwarenessQuery),\n      this\n    )\n    // broadcast local awareness state\n    const encoderAwarenessState = lib0_encoding__WEBPACK_IMPORTED_MODULE_3__.createEncoder()\n    lib0_encoding__WEBPACK_IMPORTED_MODULE_3__.writeVarUint(encoderAwarenessState, messageAwareness)\n    lib0_encoding__WEBPACK_IMPORTED_MODULE_3__.writeVarUint8Array(\n      encoderAwarenessState,\n      y_protocols_awareness__WEBPACK_IMPORTED_MODULE_2__.encodeAwarenessUpdate(this.awareness, [\n        this.doc.clientID\n      ])\n    )\n    lib0_broadcastchannel__WEBPACK_IMPORTED_MODULE_7__.publish(\n      this.bcChannel,\n      lib0_encoding__WEBPACK_IMPORTED_MODULE_3__.toUint8Array(encoderAwarenessState),\n      this\n    )\n  }\n\n  disconnectBc () {\n    // broadcast message with local awareness state set to null (indicating disconnect)\n    const encoder = lib0_encoding__WEBPACK_IMPORTED_MODULE_3__.createEncoder()\n    lib0_encoding__WEBPACK_IMPORTED_MODULE_3__.writeVarUint(encoder, messageAwareness)\n    lib0_encoding__WEBPACK_IMPORTED_MODULE_3__.writeVarUint8Array(\n      encoder,\n      y_protocols_awareness__WEBPACK_IMPORTED_MODULE_2__.encodeAwarenessUpdate(this.awareness, [\n        this.doc.clientID\n      ], new Map())\n    )\n    broadcastMessage(this, lib0_encoding__WEBPACK_IMPORTED_MODULE_3__.toUint8Array(encoder))\n    if (this.bcconnected) {\n      lib0_broadcastchannel__WEBPACK_IMPORTED_MODULE_7__.unsubscribe(this.bcChannel, this._bcSubscriber)\n      this.bcconnected = false\n    }\n  }\n\n  disconnect () {\n    this.shouldConnect = false\n    this.disconnectBc()\n    if (this.ws !== null) {\n      closeWebsocketConnection(this, this.ws, null)\n    }\n  }\n\n  connect () {\n    this.shouldConnect = true\n    if (!this.wsconnected && this.ws === null) {\n      setupWS(this)\n      this.connectBc()\n    }\n  }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHNzcikvLi9ub2RlX21vZHVsZXMveS13ZWJzb2NrZXQvc3JjL3ktd2Vic29ja2V0LmpzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRXdCO0FBQ21CO0FBQ1Y7QUFDUTtBQUNBO0FBQ087QUFDQTtBQUNVO0FBQ1o7QUFDYjtBQUNGO0FBQ1E7O0FBRWhDO0FBQ0E7QUFDQTtBQUNBOztBQUVQO0FBQ0E7QUFDQSxVQUFVO0FBQ1Y7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEVBQUUsdURBQXFCO0FBQ3ZCLDBCQUEwQiw2REFBNEI7QUFDdEQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esc0NBQXNDLGlFQUFnQztBQUN0RTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsRUFBRSx1REFBcUI7QUFDdkIsRUFBRSw2REFBMkI7QUFDN0I7QUFDQSxJQUFJLHdFQUF1QztBQUMzQztBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsRUFBRSx1RUFBc0M7QUFDeEM7QUFDQSxJQUFJLDREQUEwQjtBQUM5QjtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxFQUFFLDZEQUE0QjtBQUM5QjtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQSxXQUFXLG1CQUFtQjtBQUM5QixXQUFXLFFBQVE7QUFDbkI7QUFDQTtBQUNBLDhDQUE4QyxhQUFhLEtBQUssT0FBTzs7QUFFdkU7QUFDQSxXQUFXLG1CQUFtQjtBQUM5QixXQUFXLFlBQVk7QUFDdkIsV0FBVyxTQUFTO0FBQ3BCLFlBQVk7QUFDWjtBQUNBO0FBQ0Esa0JBQWtCLHdEQUFzQjtBQUN4QyxrQkFBa0Isd0RBQXNCO0FBQ3hDLHNCQUFzQixz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QUFJLDBEQUFVLGlCQUFpQix1REFBcUI7QUFDcEQ7QUFDQSx5QkFBeUIsd0RBQXNCO0FBQy9DLElBQUksdURBQXFCO0FBQ3pCLElBQUksNERBQTJCO0FBQy9CLElBQUksMERBQVUsaUJBQWlCLHVEQUFxQjtBQUNwRDtBQUNBLGtDQUFrQyx3REFBc0I7QUFDeEQsSUFBSSx1REFBcUI7QUFDekIsSUFBSSwwREFBVTtBQUNkO0FBQ0EsTUFBTSx1REFBcUI7QUFDM0I7QUFDQTtBQUNBO0FBQ0Esa0NBQWtDLHdEQUFzQjtBQUN4RCxJQUFJLHVEQUFxQjtBQUN6QixJQUFJLDZEQUEyQjtBQUMvQjtBQUNBLE1BQU0sd0VBQXVDO0FBQzdDO0FBQ0E7QUFDQTtBQUNBLElBQUksMERBQVU7QUFDZDtBQUNBLE1BQU0sdURBQXFCO0FBQzNCO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0Esb0JBQW9CLHdEQUFzQjtBQUMxQyxJQUFJLHVEQUFxQjtBQUN6QixJQUFJLDZEQUEyQjtBQUMvQjtBQUNBLE1BQU0sd0VBQXVDO0FBQzdDO0FBQ0E7QUFDQTtBQUNBLDJCQUEyQix1REFBcUI7QUFDaEQ7QUFDQSxNQUFNLDhEQUFjO0FBQ3BCO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vcmVhbHRpbWUtY29kZS1lZGl0b3IvLi9ub2RlX21vZHVsZXMveS13ZWJzb2NrZXQvc3JjL3ktd2Vic29ja2V0LmpzPzdkMGEiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBAbW9kdWxlIHByb3ZpZGVyL3dlYnNvY2tldFxuICovXG5cbi8qIGVzbGludC1lbnYgYnJvd3NlciAqL1xuXG5pbXBvcnQgKiBhcyBZIGZyb20gJ3lqcycgLy8gZXNsaW50LWRpc2FibGUtbGluZVxuaW1wb3J0ICogYXMgYmMgZnJvbSAnbGliMC9icm9hZGNhc3RjaGFubmVsJ1xuaW1wb3J0ICogYXMgdGltZSBmcm9tICdsaWIwL3RpbWUnXG5pbXBvcnQgKiBhcyBlbmNvZGluZyBmcm9tICdsaWIwL2VuY29kaW5nJ1xuaW1wb3J0ICogYXMgZGVjb2RpbmcgZnJvbSAnbGliMC9kZWNvZGluZydcbmltcG9ydCAqIGFzIHN5bmNQcm90b2NvbCBmcm9tICd5LXByb3RvY29scy9zeW5jJ1xuaW1wb3J0ICogYXMgYXV0aFByb3RvY29sIGZyb20gJ3ktcHJvdG9jb2xzL2F1dGgnXG5pbXBvcnQgKiBhcyBhd2FyZW5lc3NQcm90b2NvbCBmcm9tICd5LXByb3RvY29scy9hd2FyZW5lc3MnXG5pbXBvcnQgeyBPYnNlcnZhYmxlVjIgfSBmcm9tICdsaWIwL29ic2VydmFibGUnXG5pbXBvcnQgKiBhcyBtYXRoIGZyb20gJ2xpYjAvbWF0aCdcbmltcG9ydCAqIGFzIHVybCBmcm9tICdsaWIwL3VybCdcbmltcG9ydCAqIGFzIGVudiBmcm9tICdsaWIwL2Vudmlyb25tZW50J1xuXG5leHBvcnQgY29uc3QgbWVzc2FnZVN5bmMgPSAwXG5leHBvcnQgY29uc3QgbWVzc2FnZVF1ZXJ5QXdhcmVuZXNzID0gM1xuZXhwb3J0IGNvbnN0IG1lc3NhZ2VBd2FyZW5lc3MgPSAxXG5leHBvcnQgY29uc3QgbWVzc2FnZUF1dGggPSAyXG5cbi8qKlxuICogICAgICAgICAgICAgICAgICAgICAgIGVuY29kZXIsICAgICAgICAgIGRlY29kZXIsICAgICAgICAgIHByb3ZpZGVyLCAgICAgICAgICBlbWl0U3luY2VkLCBtZXNzYWdlVHlwZVxuICogQHR5cGUge0FycmF5PGZ1bmN0aW9uKGVuY29kaW5nLkVuY29kZXIsIGRlY29kaW5nLkRlY29kZXIsIFdlYnNvY2tldFByb3ZpZGVyLCBib29sZWFuLCAgICBudW1iZXIpOnZvaWQ+fVxuICovXG5jb25zdCBtZXNzYWdlSGFuZGxlcnMgPSBbXVxuXG5tZXNzYWdlSGFuZGxlcnNbbWVzc2FnZVN5bmNdID0gKFxuICBlbmNvZGVyLFxuICBkZWNvZGVyLFxuICBwcm92aWRlcixcbiAgZW1pdFN5bmNlZCxcbiAgX21lc3NhZ2VUeXBlXG4pID0+IHtcbiAgZW5jb2Rpbmcud3JpdGVWYXJVaW50KGVuY29kZXIsIG1lc3NhZ2VTeW5jKVxuICBjb25zdCBzeW5jTWVzc2FnZVR5cGUgPSBzeW5jUHJvdG9jb2wucmVhZFN5bmNNZXNzYWdlKFxuICAgIGRlY29kZXIsXG4gICAgZW5jb2RlcixcbiAgICBwcm92aWRlci5kb2MsXG4gICAgcHJvdmlkZXJcbiAgKVxuICBpZiAoXG4gICAgZW1pdFN5bmNlZCAmJiBzeW5jTWVzc2FnZVR5cGUgPT09IHN5bmNQcm90b2NvbC5tZXNzYWdlWWpzU3luY1N0ZXAyICYmXG4gICAgIXByb3ZpZGVyLnN5bmNlZFxuICApIHtcbiAgICBwcm92aWRlci5zeW5jZWQgPSB0cnVlXG4gIH1cbn1cblxubWVzc2FnZUhhbmRsZXJzW21lc3NhZ2VRdWVyeUF3YXJlbmVzc10gPSAoXG4gIGVuY29kZXIsXG4gIF9kZWNvZGVyLFxuICBwcm92aWRlcixcbiAgX2VtaXRTeW5jZWQsXG4gIF9tZXNzYWdlVHlwZVxuKSA9PiB7XG4gIGVuY29kaW5nLndyaXRlVmFyVWludChlbmNvZGVyLCBtZXNzYWdlQXdhcmVuZXNzKVxuICBlbmNvZGluZy53cml0ZVZhclVpbnQ4QXJyYXkoXG4gICAgZW5jb2RlcixcbiAgICBhd2FyZW5lc3NQcm90b2NvbC5lbmNvZGVBd2FyZW5lc3NVcGRhdGUoXG4gICAgICBwcm92aWRlci5hd2FyZW5lc3MsXG4gICAgICBBcnJheS5mcm9tKHByb3ZpZGVyLmF3YXJlbmVzcy5nZXRTdGF0ZXMoKS5rZXlzKCkpXG4gICAgKVxuICApXG59XG5cbm1lc3NhZ2VIYW5kbGVyc1ttZXNzYWdlQXdhcmVuZXNzXSA9IChcbiAgX2VuY29kZXIsXG4gIGRlY29kZXIsXG4gIHByb3ZpZGVyLFxuICBfZW1pdFN5bmNlZCxcbiAgX21lc3NhZ2VUeXBlXG4pID0+IHtcbiAgYXdhcmVuZXNzUHJvdG9jb2wuYXBwbHlBd2FyZW5lc3NVcGRhdGUoXG4gICAgcHJvdmlkZXIuYXdhcmVuZXNzLFxuICAgIGRlY29kaW5nLnJlYWRWYXJVaW50OEFycmF5KGRlY29kZXIpLFxuICAgIHByb3ZpZGVyXG4gIClcbn1cblxubWVzc2FnZUhhbmRsZXJzW21lc3NhZ2VBdXRoXSA9IChcbiAgX2VuY29kZXIsXG4gIGRlY29kZXIsXG4gIHByb3ZpZGVyLFxuICBfZW1pdFN5bmNlZCxcbiAgX21lc3NhZ2VUeXBlXG4pID0+IHtcbiAgYXV0aFByb3RvY29sLnJlYWRBdXRoTWVzc2FnZShcbiAgICBkZWNvZGVyLFxuICAgIHByb3ZpZGVyLmRvYyxcbiAgICAoX3lkb2MsIHJlYXNvbikgPT4gcGVybWlzc2lvbkRlbmllZEhhbmRsZXIocHJvdmlkZXIsIHJlYXNvbilcbiAgKVxufVxuXG4vLyBAdG9kbyAtIHRoaXMgc2hvdWxkIGRlcGVuZCBvbiBhd2FyZW5lc3Mub3V0ZGF0ZWRUaW1lXG5jb25zdCBtZXNzYWdlUmVjb25uZWN0VGltZW91dCA9IDMwMDAwXG5cbi8qKlxuICogQHBhcmFtIHtXZWJzb2NrZXRQcm92aWRlcn0gcHJvdmlkZXJcbiAqIEBwYXJhbSB7c3RyaW5nfSByZWFzb25cbiAqL1xuY29uc3QgcGVybWlzc2lvbkRlbmllZEhhbmRsZXIgPSAocHJvdmlkZXIsIHJlYXNvbikgPT5cbiAgY29uc29sZS53YXJuKGBQZXJtaXNzaW9uIGRlbmllZCB0byBhY2Nlc3MgJHtwcm92aWRlci51cmx9LlxcbiR7cmVhc29ufWApXG5cbi8qKlxuICogQHBhcmFtIHtXZWJzb2NrZXRQcm92aWRlcn0gcHJvdmlkZXJcbiAqIEBwYXJhbSB7VWludDhBcnJheX0gYnVmXG4gKiBAcGFyYW0ge2Jvb2xlYW59IGVtaXRTeW5jZWRcbiAqIEByZXR1cm4ge2VuY29kaW5nLkVuY29kZXJ9XG4gKi9cbmNvbnN0IHJlYWRNZXNzYWdlID0gKHByb3ZpZGVyLCBidWYsIGVtaXRTeW5jZWQpID0+IHtcbiAgY29uc3QgZGVjb2RlciA9IGRlY29kaW5nLmNyZWF0ZURlY29kZXIoYnVmKVxuICBjb25zdCBlbmNvZGVyID0gZW5jb2RpbmcuY3JlYXRlRW5jb2RlcigpXG4gIGNvbnN0IG1lc3NhZ2VUeXBlID0gZGVjb2RpbmcucmVhZFZhclVpbnQoZGVjb2RlcilcbiAgY29uc3QgbWVzc2FnZUhhbmRsZXIgPSBwcm92aWRlci5tZXNzYWdlSGFuZGxlcnNbbWVzc2FnZVR5cGVdXG4gIGlmICgvKiogQHR5cGUge2FueX0gKi8gKG1lc3NhZ2VIYW5kbGVyKSkge1xuICAgIG1lc3NhZ2VIYW5kbGVyKGVuY29kZXIsIGRlY29kZXIsIHByb3ZpZGVyLCBlbWl0U3luY2VkLCBtZXNzYWdlVHlwZSlcbiAgfSBlbHNlIHtcbiAgICBjb25zb2xlLmVycm9yKCdVbmFibGUgdG8gY29tcHV0ZSBtZXNzYWdlJylcbiAgfVxuICByZXR1cm4gZW5jb2RlclxufVxuXG4vKipcbiAqIE91dHNvdXJjZSB0aGlzIGZ1bmN0aW9uIHNvIHRoYXQgYSBuZXcgd2Vic29ja2V0IGNvbm5lY3Rpb24gaXMgY3JlYXRlZCBpbW1lZGlhdGVseS5cbiAqIEkgc3VzcGVjdCB0aGF0IHRoZSBgd3Mub25jbG9zZWAgZXZlbnQgaXMgbm90IGFsd2F5cyBmaXJlZCBpZiB0aGVyZSBhcmUgbmV0d29yayBpc3N1ZXMuXG4gKlxuICogQHBhcmFtIHtXZWJzb2NrZXRQcm92aWRlcn0gcHJvdmlkZXJcbiAqIEBwYXJhbSB7V2ViU29ja2V0fSB3c1xuICogQHBhcmFtIHtDbG9zZUV2ZW50IHwgbnVsbH0gZXZlbnRcbiAqL1xuY29uc3QgY2xvc2VXZWJzb2NrZXRDb25uZWN0aW9uID0gKHByb3ZpZGVyLCB3cywgZXZlbnQpID0+IHtcbiAgaWYgKHdzID09PSBwcm92aWRlci53cykge1xuICAgIHByb3ZpZGVyLmVtaXQoJ2Nvbm5lY3Rpb24tY2xvc2UnLCBbZXZlbnQsIHByb3ZpZGVyXSlcbiAgICBwcm92aWRlci53cyA9IG51bGxcbiAgICB3cy5jbG9zZSgpXG4gICAgcHJvdmlkZXIud3Njb25uZWN0aW5nID0gZmFsc2VcbiAgICBpZiAocHJvdmlkZXIud3Njb25uZWN0ZWQpIHtcbiAgICAgIHByb3ZpZGVyLndzY29ubmVjdGVkID0gZmFsc2VcbiAgICAgIHByb3ZpZGVyLnN5bmNlZCA9IGZhbHNlXG4gICAgICAvLyB1cGRhdGUgYXdhcmVuZXNzIChhbGwgdXNlcnMgZXhjZXB0IGxvY2FsIGxlZnQpXG4gICAgICBhd2FyZW5lc3NQcm90b2NvbC5yZW1vdmVBd2FyZW5lc3NTdGF0ZXMoXG4gICAgICAgIHByb3ZpZGVyLmF3YXJlbmVzcyxcbiAgICAgICAgQXJyYXkuZnJvbShwcm92aWRlci5hd2FyZW5lc3MuZ2V0U3RhdGVzKCkua2V5cygpKS5maWx0ZXIoKGNsaWVudCkgPT5cbiAgICAgICAgICBjbGllbnQgIT09IHByb3ZpZGVyLmRvYy5jbGllbnRJRFxuICAgICAgICApLFxuICAgICAgICBwcm92aWRlclxuICAgICAgKVxuICAgICAgcHJvdmlkZXIuZW1pdCgnc3RhdHVzJywgW3tcbiAgICAgICAgc3RhdHVzOiAnZGlzY29ubmVjdGVkJ1xuICAgICAgfV0pXG4gICAgfSBlbHNlIHtcbiAgICAgIHByb3ZpZGVyLndzVW5zdWNjZXNzZnVsUmVjb25uZWN0cysrXG4gICAgfVxuICAgIC8vIFN0YXJ0IHdpdGggbm8gcmVjb25uZWN0IHRpbWVvdXQgYW5kIGluY3JlYXNlIHRpbWVvdXQgYnlcbiAgICAvLyB1c2luZyBleHBvbmVudGlhbCBiYWNrb2ZmIHN0YXJ0aW5nIHdpdGggMTAwbXNcbiAgICBzZXRUaW1lb3V0KFxuICAgICAgc2V0dXBXUyxcbiAgICAgIG1hdGgubWluKFxuICAgICAgICBtYXRoLnBvdygyLCBwcm92aWRlci53c1Vuc3VjY2Vzc2Z1bFJlY29ubmVjdHMpICogMTAwLFxuICAgICAgICBwcm92aWRlci5tYXhCYWNrb2ZmVGltZVxuICAgICAgKSxcbiAgICAgIHByb3ZpZGVyXG4gICAgKVxuICB9XG59XG5cbi8qKlxuICogQHBhcmFtIHtXZWJzb2NrZXRQcm92aWRlcn0gcHJvdmlkZXJcbiAqL1xuY29uc3Qgc2V0dXBXUyA9IChwcm92aWRlcikgPT4ge1xuICBpZiAocHJvdmlkZXIuc2hvdWxkQ29ubmVjdCAmJiBwcm92aWRlci53cyA9PT0gbnVsbCkge1xuICAgIGNvbnN0IHdlYnNvY2tldCA9IG5ldyBwcm92aWRlci5fV1MocHJvdmlkZXIudXJsLCBwcm92aWRlci5wcm90b2NvbHMpXG4gICAgd2Vic29ja2V0LmJpbmFyeVR5cGUgPSAnYXJyYXlidWZmZXInXG4gICAgcHJvdmlkZXIud3MgPSB3ZWJzb2NrZXRcbiAgICBwcm92aWRlci53c2Nvbm5lY3RpbmcgPSB0cnVlXG4gICAgcHJvdmlkZXIud3Njb25uZWN0ZWQgPSBmYWxzZVxuICAgIHByb3ZpZGVyLnN5bmNlZCA9IGZhbHNlXG5cbiAgICB3ZWJzb2NrZXQub25tZXNzYWdlID0gKGV2ZW50KSA9PiB7XG4gICAgICBwcm92aWRlci53c0xhc3RNZXNzYWdlUmVjZWl2ZWQgPSB0aW1lLmdldFVuaXhUaW1lKClcbiAgICAgIGNvbnN0IGVuY29kZXIgPSByZWFkTWVzc2FnZShwcm92aWRlciwgbmV3IFVpbnQ4QXJyYXkoZXZlbnQuZGF0YSksIHRydWUpXG4gICAgICBpZiAoZW5jb2RpbmcubGVuZ3RoKGVuY29kZXIpID4gMSkge1xuICAgICAgICB3ZWJzb2NrZXQuc2VuZChlbmNvZGluZy50b1VpbnQ4QXJyYXkoZW5jb2RlcikpXG4gICAgICB9XG4gICAgfVxuICAgIHdlYnNvY2tldC5vbmVycm9yID0gKGV2ZW50KSA9PiB7XG4gICAgICBwcm92aWRlci5lbWl0KCdjb25uZWN0aW9uLWVycm9yJywgW2V2ZW50LCBwcm92aWRlcl0pXG4gICAgfVxuICAgIHdlYnNvY2tldC5vbmNsb3NlID0gKGV2ZW50KSA9PiB7XG4gICAgICBjbG9zZVdlYnNvY2tldENvbm5lY3Rpb24ocHJvdmlkZXIsIHdlYnNvY2tldCwgZXZlbnQpXG4gICAgfVxuICAgIHdlYnNvY2tldC5vbm9wZW4gPSAoKSA9PiB7XG4gICAgICBwcm92aWRlci53c0xhc3RNZXNzYWdlUmVjZWl2ZWQgPSB0aW1lLmdldFVuaXhUaW1lKClcbiAgICAgIHByb3ZpZGVyLndzY29ubmVjdGluZyA9IGZhbHNlXG4gICAgICBwcm92aWRlci53c2Nvbm5lY3RlZCA9IHRydWVcbiAgICAgIHByb3ZpZGVyLndzVW5zdWNjZXNzZnVsUmVjb25uZWN0cyA9IDBcbiAgICAgIHByb3ZpZGVyLmVtaXQoJ3N0YXR1cycsIFt7XG4gICAgICAgIHN0YXR1czogJ2Nvbm5lY3RlZCdcbiAgICAgIH1dKVxuICAgICAgLy8gYWx3YXlzIHNlbmQgc3luYyBzdGVwIDEgd2hlbiBjb25uZWN0ZWRcbiAgICAgIGNvbnN0IGVuY29kZXIgPSBlbmNvZGluZy5jcmVhdGVFbmNvZGVyKClcbiAgICAgIGVuY29kaW5nLndyaXRlVmFyVWludChlbmNvZGVyLCBtZXNzYWdlU3luYylcbiAgICAgIHN5bmNQcm90b2NvbC53cml0ZVN5bmNTdGVwMShlbmNvZGVyLCBwcm92aWRlci5kb2MpXG4gICAgICB3ZWJzb2NrZXQuc2VuZChlbmNvZGluZy50b1VpbnQ4QXJyYXkoZW5jb2RlcikpXG4gICAgICAvLyBicm9hZGNhc3QgbG9jYWwgYXdhcmVuZXNzIHN0YXRlXG4gICAgICBpZiAocHJvdmlkZXIuYXdhcmVuZXNzLmdldExvY2FsU3RhdGUoKSAhPT0gbnVsbCkge1xuICAgICAgICBjb25zdCBlbmNvZGVyQXdhcmVuZXNzU3RhdGUgPSBlbmNvZGluZy5jcmVhdGVFbmNvZGVyKClcbiAgICAgICAgZW5jb2Rpbmcud3JpdGVWYXJVaW50KGVuY29kZXJBd2FyZW5lc3NTdGF0ZSwgbWVzc2FnZUF3YXJlbmVzcylcbiAgICAgICAgZW5jb2Rpbmcud3JpdGVWYXJVaW50OEFycmF5KFxuICAgICAgICAgIGVuY29kZXJBd2FyZW5lc3NTdGF0ZSxcbiAgICAgICAgICBhd2FyZW5lc3NQcm90b2NvbC5lbmNvZGVBd2FyZW5lc3NVcGRhdGUocHJvdmlkZXIuYXdhcmVuZXNzLCBbXG4gICAgICAgICAgICBwcm92aWRlci5kb2MuY2xpZW50SURcbiAgICAgICAgICBdKVxuICAgICAgICApXG4gICAgICAgIHdlYnNvY2tldC5zZW5kKGVuY29kaW5nLnRvVWludDhBcnJheShlbmNvZGVyQXdhcmVuZXNzU3RhdGUpKVxuICAgICAgfVxuICAgIH1cbiAgICBwcm92aWRlci5lbWl0KCdzdGF0dXMnLCBbe1xuICAgICAgc3RhdHVzOiAnY29ubmVjdGluZydcbiAgICB9XSlcbiAgfVxufVxuXG4vKipcbiAqIEBwYXJhbSB7V2Vic29ja2V0UHJvdmlkZXJ9IHByb3ZpZGVyXG4gKiBAcGFyYW0ge0FycmF5QnVmZmVyfSBidWZcbiAqL1xuY29uc3QgYnJvYWRjYXN0TWVzc2FnZSA9IChwcm92aWRlciwgYnVmKSA9PiB7XG4gIGNvbnN0IHdzID0gcHJvdmlkZXIud3NcbiAgaWYgKHByb3ZpZGVyLndzY29ubmVjdGVkICYmIHdzICYmIHdzLnJlYWR5U3RhdGUgPT09IHdzLk9QRU4pIHtcbiAgICB3cy5zZW5kKGJ1ZilcbiAgfVxuICBpZiAocHJvdmlkZXIuYmNjb25uZWN0ZWQpIHtcbiAgICBiYy5wdWJsaXNoKHByb3ZpZGVyLmJjQ2hhbm5lbCwgYnVmLCBwcm92aWRlcilcbiAgfVxufVxuXG4vKipcbiAqIFdlYnNvY2tldCBQcm92aWRlciBmb3IgWWpzLiBDcmVhdGVzIGEgd2Vic29ja2V0IGNvbm5lY3Rpb24gdG8gc3luYyB0aGUgc2hhcmVkIGRvY3VtZW50LlxuICogVGhlIGRvY3VtZW50IG5hbWUgaXMgYXR0YWNoZWQgdG8gdGhlIHByb3ZpZGVkIHVybC4gSS5lLiB0aGUgZm9sbG93aW5nIGV4YW1wbGVcbiAqIGNyZWF0ZXMgYSB3ZWJzb2NrZXQgY29ubmVjdGlvbiB0byBodHRwOi8vbG9jYWxob3N0OjEyMzQvbXktZG9jdW1lbnQtbmFtZVxuICpcbiAqIEBleGFtcGxlXG4gKiAgIGltcG9ydCAqIGFzIFkgZnJvbSAneWpzJ1xuICogICBpbXBvcnQgeyBXZWJzb2NrZXRQcm92aWRlciB9IGZyb20gJ3ktd2Vic29ja2V0J1xuICogICBjb25zdCBkb2MgPSBuZXcgWS5Eb2MoKVxuICogICBjb25zdCBwcm92aWRlciA9IG5ldyBXZWJzb2NrZXRQcm92aWRlcignaHR0cDovL2xvY2FsaG9zdDoxMjM0JywgJ215LWRvY3VtZW50LW5hbWUnLCBkb2MpXG4gKlxuICogQGV4dGVuZHMge09ic2VydmFibGVWMjx7ICdjb25uZWN0aW9uLWNsb3NlJzogKGV2ZW50OiBDbG9zZUV2ZW50IHwgbnVsbCwgIHByb3ZpZGVyOiBXZWJzb2NrZXRQcm92aWRlcikgPT4gYW55LCAnc3RhdHVzJzogKGV2ZW50OiB7IHN0YXR1czogJ2Nvbm5lY3RlZCcgfCAnZGlzY29ubmVjdGVkJyB8ICdjb25uZWN0aW5nJyB9KSA9PiBhbnksICdjb25uZWN0aW9uLWVycm9yJzogKGV2ZW50OiBFdmVudCwgcHJvdmlkZXI6IFdlYnNvY2tldFByb3ZpZGVyKSA9PiBhbnksICdzeW5jJzogKHN0YXRlOiBib29sZWFuKSA9PiBhbnkgfT59XG4gKi9cbmV4cG9ydCBjbGFzcyBXZWJzb2NrZXRQcm92aWRlciBleHRlbmRzIE9ic2VydmFibGVWMiB7XG4gIC8qKlxuICAgKiBAcGFyYW0ge3N0cmluZ30gc2VydmVyVXJsXG4gICAqIEBwYXJhbSB7c3RyaW5nfSByb29tbmFtZVxuICAgKiBAcGFyYW0ge1kuRG9jfSBkb2NcbiAgICogQHBhcmFtIHtvYmplY3R9IG9wdHNcbiAgICogQHBhcmFtIHtib29sZWFufSBbb3B0cy5jb25uZWN0XVxuICAgKiBAcGFyYW0ge2F3YXJlbmVzc1Byb3RvY29sLkF3YXJlbmVzc30gW29wdHMuYXdhcmVuZXNzXVxuICAgKiBAcGFyYW0ge09iamVjdDxzdHJpbmcsc3RyaW5nPn0gW29wdHMucGFyYW1zXSBzcGVjaWZ5IHVybCBwYXJhbWV0ZXJzXG4gICAqIEBwYXJhbSB7QXJyYXk8c3RyaW5nPn0gW29wdHMucHJvdG9jb2xzXSBzcGVjaWZ5IHdlYnNvY2tldCBwcm90b2NvbHNcbiAgICogQHBhcmFtIHt0eXBlb2YgV2ViU29ja2V0fSBbb3B0cy5XZWJTb2NrZXRQb2x5ZmlsbF0gT3B0aW9uYWxsIHByb3ZpZGUgYSBXZWJTb2NrZXQgcG9seWZpbGxcbiAgICogQHBhcmFtIHtudW1iZXJ9IFtvcHRzLnJlc3luY0ludGVydmFsXSBSZXF1ZXN0IHNlcnZlciBzdGF0ZSBldmVyeSBgcmVzeW5jSW50ZXJ2YWxgIG1pbGxpc2Vjb25kc1xuICAgKiBAcGFyYW0ge251bWJlcn0gW29wdHMubWF4QmFja29mZlRpbWVdIE1heGltdW0gYW1vdW50IG9mIHRpbWUgdG8gd2FpdCBiZWZvcmUgdHJ5aW5nIHRvIHJlY29ubmVjdCAod2UgdHJ5IHRvIHJlY29ubmVjdCB1c2luZyBleHBvbmVudGlhbCBiYWNrb2ZmKVxuICAgKiBAcGFyYW0ge2Jvb2xlYW59IFtvcHRzLmRpc2FibGVCY10gRGlzYWJsZSBjcm9zcy10YWIgQnJvYWRjYXN0Q2hhbm5lbCBjb21tdW5pY2F0aW9uXG4gICAqL1xuICBjb25zdHJ1Y3RvciAoc2VydmVyVXJsLCByb29tbmFtZSwgZG9jLCB7XG4gICAgY29ubmVjdCA9IHRydWUsXG4gICAgYXdhcmVuZXNzID0gbmV3IGF3YXJlbmVzc1Byb3RvY29sLkF3YXJlbmVzcyhkb2MpLFxuICAgIHBhcmFtcyA9IHt9LFxuICAgIHByb3RvY29scyA9IFtdLFxuICAgIFdlYlNvY2tldFBvbHlmaWxsID0gV2ViU29ja2V0LFxuICAgIHJlc3luY0ludGVydmFsID0gLTEsXG4gICAgbWF4QmFja29mZlRpbWUgPSAyNTAwLFxuICAgIGRpc2FibGVCYyA9IGZhbHNlXG4gIH0gPSB7fSkge1xuICAgIHN1cGVyKClcbiAgICAvLyBlbnN1cmUgdGhhdCB1cmwgaXMgYWx3YXlzIGVuZHMgd2l0aCAvXG4gICAgd2hpbGUgKHNlcnZlclVybFtzZXJ2ZXJVcmwubGVuZ3RoIC0gMV0gPT09ICcvJykge1xuICAgICAgc2VydmVyVXJsID0gc2VydmVyVXJsLnNsaWNlKDAsIHNlcnZlclVybC5sZW5ndGggLSAxKVxuICAgIH1cbiAgICB0aGlzLnNlcnZlclVybCA9IHNlcnZlclVybFxuICAgIHRoaXMuYmNDaGFubmVsID0gc2VydmVyVXJsICsgJy8nICsgcm9vbW5hbWVcbiAgICB0aGlzLm1heEJhY2tvZmZUaW1lID0gbWF4QmFja29mZlRpbWVcbiAgICAvKipcbiAgICAgKiBUaGUgc3BlY2lmaWVkIHVybCBwYXJhbWV0ZXJzLiBUaGlzIGNhbiBiZSBzYWZlbHkgdXBkYXRlZC4gVGhlIGNoYW5nZWQgcGFyYW1ldGVycyB3aWxsIGJlIHVzZWRcbiAgICAgKiB3aGVuIGEgbmV3IGNvbm5lY3Rpb24gaXMgZXN0YWJsaXNoZWQuXG4gICAgICogQHR5cGUge09iamVjdDxzdHJpbmcsc3RyaW5nPn1cbiAgICAgKi9cbiAgICB0aGlzLnBhcmFtcyA9IHBhcmFtc1xuICAgIHRoaXMucHJvdG9jb2xzID0gcHJvdG9jb2xzXG4gICAgdGhpcy5yb29tbmFtZSA9IHJvb21uYW1lXG4gICAgdGhpcy5kb2MgPSBkb2NcbiAgICB0aGlzLl9XUyA9IFdlYlNvY2tldFBvbHlmaWxsXG4gICAgdGhpcy5hd2FyZW5lc3MgPSBhd2FyZW5lc3NcbiAgICB0aGlzLndzY29ubmVjdGVkID0gZmFsc2VcbiAgICB0aGlzLndzY29ubmVjdGluZyA9IGZhbHNlXG4gICAgdGhpcy5iY2Nvbm5lY3RlZCA9IGZhbHNlXG4gICAgdGhpcy5kaXNhYmxlQmMgPSBkaXNhYmxlQmNcbiAgICB0aGlzLndzVW5zdWNjZXNzZnVsUmVjb25uZWN0cyA9IDBcbiAgICB0aGlzLm1lc3NhZ2VIYW5kbGVycyA9IG1lc3NhZ2VIYW5kbGVycy5zbGljZSgpXG4gICAgLyoqXG4gICAgICogQHR5cGUge2Jvb2xlYW59XG4gICAgICovXG4gICAgdGhpcy5fc3luY2VkID0gZmFsc2VcbiAgICAvKipcbiAgICAgKiBAdHlwZSB7V2ViU29ja2V0P31cbiAgICAgKi9cbiAgICB0aGlzLndzID0gbnVsbFxuICAgIHRoaXMud3NMYXN0TWVzc2FnZVJlY2VpdmVkID0gMFxuICAgIC8qKlxuICAgICAqIFdoZXRoZXIgdG8gY29ubmVjdCB0byBvdGhlciBwZWVycyBvciBub3RcbiAgICAgKiBAdHlwZSB7Ym9vbGVhbn1cbiAgICAgKi9cbiAgICB0aGlzLnNob3VsZENvbm5lY3QgPSBjb25uZWN0XG5cbiAgICAvKipcbiAgICAgKiBAdHlwZSB7bnVtYmVyfVxuICAgICAqL1xuICAgIHRoaXMuX3Jlc3luY0ludGVydmFsID0gMFxuICAgIGlmIChyZXN5bmNJbnRlcnZhbCA+IDApIHtcbiAgICAgIHRoaXMuX3Jlc3luY0ludGVydmFsID0gLyoqIEB0eXBlIHthbnl9ICovIChzZXRJbnRlcnZhbCgoKSA9PiB7XG4gICAgICAgIGlmICh0aGlzLndzICYmIHRoaXMud3MucmVhZHlTdGF0ZSA9PT0gV2ViU29ja2V0Lk9QRU4pIHtcbiAgICAgICAgICAvLyByZXNlbmQgc3luYyBzdGVwIDFcbiAgICAgICAgICBjb25zdCBlbmNvZGVyID0gZW5jb2RpbmcuY3JlYXRlRW5jb2RlcigpXG4gICAgICAgICAgZW5jb2Rpbmcud3JpdGVWYXJVaW50KGVuY29kZXIsIG1lc3NhZ2VTeW5jKVxuICAgICAgICAgIHN5bmNQcm90b2NvbC53cml0ZVN5bmNTdGVwMShlbmNvZGVyLCBkb2MpXG4gICAgICAgICAgdGhpcy53cy5zZW5kKGVuY29kaW5nLnRvVWludDhBcnJheShlbmNvZGVyKSlcbiAgICAgICAgfVxuICAgICAgfSwgcmVzeW5jSW50ZXJ2YWwpKVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEBwYXJhbSB7QXJyYXlCdWZmZXJ9IGRhdGFcbiAgICAgKiBAcGFyYW0ge2FueX0gb3JpZ2luXG4gICAgICovXG4gICAgdGhpcy5fYmNTdWJzY3JpYmVyID0gKGRhdGEsIG9yaWdpbikgPT4ge1xuICAgICAgaWYgKG9yaWdpbiAhPT0gdGhpcykge1xuICAgICAgICBjb25zdCBlbmNvZGVyID0gcmVhZE1lc3NhZ2UodGhpcywgbmV3IFVpbnQ4QXJyYXkoZGF0YSksIGZhbHNlKVxuICAgICAgICBpZiAoZW5jb2RpbmcubGVuZ3RoKGVuY29kZXIpID4gMSkge1xuICAgICAgICAgIGJjLnB1Ymxpc2godGhpcy5iY0NoYW5uZWwsIGVuY29kaW5nLnRvVWludDhBcnJheShlbmNvZGVyKSwgdGhpcylcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgICAvKipcbiAgICAgKiBMaXN0ZW5zIHRvIFlqcyB1cGRhdGVzIGFuZCBzZW5kcyB0aGVtIHRvIHJlbW90ZSBwZWVycyAod3MgYW5kIGJyb2FkY2FzdGNoYW5uZWwpXG4gICAgICogQHBhcmFtIHtVaW50OEFycmF5fSB1cGRhdGVcbiAgICAgKiBAcGFyYW0ge2FueX0gb3JpZ2luXG4gICAgICovXG4gICAgdGhpcy5fdXBkYXRlSGFuZGxlciA9ICh1cGRhdGUsIG9yaWdpbikgPT4ge1xuICAgICAgaWYgKG9yaWdpbiAhPT0gdGhpcykge1xuICAgICAgICBjb25zdCBlbmNvZGVyID0gZW5jb2RpbmcuY3JlYXRlRW5jb2RlcigpXG4gICAgICAgIGVuY29kaW5nLndyaXRlVmFyVWludChlbmNvZGVyLCBtZXNzYWdlU3luYylcbiAgICAgICAgc3luY1Byb3RvY29sLndyaXRlVXBkYXRlKGVuY29kZXIsIHVwZGF0ZSlcbiAgICAgICAgYnJvYWRjYXN0TWVzc2FnZSh0aGlzLCBlbmNvZGluZy50b1VpbnQ4QXJyYXkoZW5jb2RlcikpXG4gICAgICB9XG4gICAgfVxuICAgIHRoaXMuZG9jLm9uKCd1cGRhdGUnLCB0aGlzLl91cGRhdGVIYW5kbGVyKVxuICAgIC8qKlxuICAgICAqIEBwYXJhbSB7YW55fSBjaGFuZ2VkXG4gICAgICogQHBhcmFtIHthbnl9IF9vcmlnaW5cbiAgICAgKi9cbiAgICB0aGlzLl9hd2FyZW5lc3NVcGRhdGVIYW5kbGVyID0gKHsgYWRkZWQsIHVwZGF0ZWQsIHJlbW92ZWQgfSwgX29yaWdpbikgPT4ge1xuICAgICAgY29uc3QgY2hhbmdlZENsaWVudHMgPSBhZGRlZC5jb25jYXQodXBkYXRlZCkuY29uY2F0KHJlbW92ZWQpXG4gICAgICBjb25zdCBlbmNvZGVyID0gZW5jb2RpbmcuY3JlYXRlRW5jb2RlcigpXG4gICAgICBlbmNvZGluZy53cml0ZVZhclVpbnQoZW5jb2RlciwgbWVzc2FnZUF3YXJlbmVzcylcbiAgICAgIGVuY29kaW5nLndyaXRlVmFyVWludDhBcnJheShcbiAgICAgICAgZW5jb2RlcixcbiAgICAgICAgYXdhcmVuZXNzUHJvdG9jb2wuZW5jb2RlQXdhcmVuZXNzVXBkYXRlKGF3YXJlbmVzcywgY2hhbmdlZENsaWVudHMpXG4gICAgICApXG4gICAgICBicm9hZGNhc3RNZXNzYWdlKHRoaXMsIGVuY29kaW5nLnRvVWludDhBcnJheShlbmNvZGVyKSlcbiAgICB9XG4gICAgdGhpcy5fZXhpdEhhbmRsZXIgPSAoKSA9PiB7XG4gICAgICBhd2FyZW5lc3NQcm90b2NvbC5yZW1vdmVBd2FyZW5lc3NTdGF0ZXMoXG4gICAgICAgIHRoaXMuYXdhcmVuZXNzLFxuICAgICAgICBbZG9jLmNsaWVudElEXSxcbiAgICAgICAgJ2FwcCBjbG9zZWQnXG4gICAgICApXG4gICAgfVxuICAgIGlmIChlbnYuaXNOb2RlICYmIHR5cGVvZiBwcm9jZXNzICE9PSAndW5kZWZpbmVkJykge1xuICAgICAgcHJvY2Vzcy5vbignZXhpdCcsIHRoaXMuX2V4aXRIYW5kbGVyKVxuICAgIH1cbiAgICBhd2FyZW5lc3Mub24oJ3VwZGF0ZScsIHRoaXMuX2F3YXJlbmVzc1VwZGF0ZUhhbmRsZXIpXG4gICAgdGhpcy5fY2hlY2tJbnRlcnZhbCA9IC8qKiBAdHlwZSB7YW55fSAqLyAoc2V0SW50ZXJ2YWwoKCkgPT4ge1xuICAgICAgaWYgKFxuICAgICAgICB0aGlzLndzY29ubmVjdGVkICYmXG4gICAgICAgIG1lc3NhZ2VSZWNvbm5lY3RUaW1lb3V0IDxcbiAgICAgICAgICB0aW1lLmdldFVuaXhUaW1lKCkgLSB0aGlzLndzTGFzdE1lc3NhZ2VSZWNlaXZlZFxuICAgICAgKSB7XG4gICAgICAgIC8vIG5vIG1lc3NhZ2UgcmVjZWl2ZWQgaW4gYSBsb25nIHRpbWUgLSBub3QgZXZlbiB5b3VyIG93biBhd2FyZW5lc3NcbiAgICAgICAgLy8gdXBkYXRlcyAod2hpY2ggYXJlIHVwZGF0ZWQgZXZlcnkgMTUgc2Vjb25kcylcbiAgICAgICAgY2xvc2VXZWJzb2NrZXRDb25uZWN0aW9uKHRoaXMsIC8qKiBAdHlwZSB7V2ViU29ja2V0fSAqLyAodGhpcy53cyksIG51bGwpXG4gICAgICB9XG4gICAgfSwgbWVzc2FnZVJlY29ubmVjdFRpbWVvdXQgLyAxMCkpXG4gICAgaWYgKGNvbm5lY3QpIHtcbiAgICAgIHRoaXMuY29ubmVjdCgpXG4gICAgfVxuICB9XG5cbiAgZ2V0IHVybCAoKSB7XG4gICAgY29uc3QgZW5jb2RlZFBhcmFtcyA9IHVybC5lbmNvZGVRdWVyeVBhcmFtcyh0aGlzLnBhcmFtcylcbiAgICByZXR1cm4gdGhpcy5zZXJ2ZXJVcmwgKyAnLycgKyB0aGlzLnJvb21uYW1lICtcbiAgICAgIChlbmNvZGVkUGFyYW1zLmxlbmd0aCA9PT0gMCA/ICcnIDogJz8nICsgZW5jb2RlZFBhcmFtcylcbiAgfVxuXG4gIC8qKlxuICAgKiBAdHlwZSB7Ym9vbGVhbn1cbiAgICovXG4gIGdldCBzeW5jZWQgKCkge1xuICAgIHJldHVybiB0aGlzLl9zeW5jZWRcbiAgfVxuXG4gIHNldCBzeW5jZWQgKHN0YXRlKSB7XG4gICAgaWYgKHRoaXMuX3N5bmNlZCAhPT0gc3RhdGUpIHtcbiAgICAgIHRoaXMuX3N5bmNlZCA9IHN0YXRlXG4gICAgICAvLyBAdHMtaWdub3JlXG4gICAgICB0aGlzLmVtaXQoJ3N5bmNlZCcsIFtzdGF0ZV0pXG4gICAgICB0aGlzLmVtaXQoJ3N5bmMnLCBbc3RhdGVdKVxuICAgIH1cbiAgfVxuXG4gIGRlc3Ryb3kgKCkge1xuICAgIGlmICh0aGlzLl9yZXN5bmNJbnRlcnZhbCAhPT0gMCkge1xuICAgICAgY2xlYXJJbnRlcnZhbCh0aGlzLl9yZXN5bmNJbnRlcnZhbClcbiAgICB9XG4gICAgY2xlYXJJbnRlcnZhbCh0aGlzLl9jaGVja0ludGVydmFsKVxuICAgIHRoaXMuZGlzY29ubmVjdCgpXG4gICAgaWYgKGVudi5pc05vZGUgJiYgdHlwZW9mIHByb2Nlc3MgIT09ICd1bmRlZmluZWQnKSB7XG4gICAgICBwcm9jZXNzLm9mZignZXhpdCcsIHRoaXMuX2V4aXRIYW5kbGVyKVxuICAgIH1cbiAgICB0aGlzLmF3YXJlbmVzcy5vZmYoJ3VwZGF0ZScsIHRoaXMuX2F3YXJlbmVzc1VwZGF0ZUhhbmRsZXIpXG4gICAgdGhpcy5kb2Mub2ZmKCd1cGRhdGUnLCB0aGlzLl91cGRhdGVIYW5kbGVyKVxuICAgIHN1cGVyLmRlc3Ryb3koKVxuICB9XG5cbiAgY29ubmVjdEJjICgpIHtcbiAgICBpZiAodGhpcy5kaXNhYmxlQmMpIHtcbiAgICAgIHJldHVyblxuICAgIH1cbiAgICBpZiAoIXRoaXMuYmNjb25uZWN0ZWQpIHtcbiAgICAgIGJjLnN1YnNjcmliZSh0aGlzLmJjQ2hhbm5lbCwgdGhpcy5fYmNTdWJzY3JpYmVyKVxuICAgICAgdGhpcy5iY2Nvbm5lY3RlZCA9IHRydWVcbiAgICB9XG4gICAgLy8gc2VuZCBzeW5jIHN0ZXAxIHRvIGJjXG4gICAgLy8gd3JpdGUgc3luYyBzdGVwIDFcbiAgICBjb25zdCBlbmNvZGVyU3luYyA9IGVuY29kaW5nLmNyZWF0ZUVuY29kZXIoKVxuICAgIGVuY29kaW5nLndyaXRlVmFyVWludChlbmNvZGVyU3luYywgbWVzc2FnZVN5bmMpXG4gICAgc3luY1Byb3RvY29sLndyaXRlU3luY1N0ZXAxKGVuY29kZXJTeW5jLCB0aGlzLmRvYylcbiAgICBiYy5wdWJsaXNoKHRoaXMuYmNDaGFubmVsLCBlbmNvZGluZy50b1VpbnQ4QXJyYXkoZW5jb2RlclN5bmMpLCB0aGlzKVxuICAgIC8vIGJyb2FkY2FzdCBsb2NhbCBzdGF0ZVxuICAgIGNvbnN0IGVuY29kZXJTdGF0ZSA9IGVuY29kaW5nLmNyZWF0ZUVuY29kZXIoKVxuICAgIGVuY29kaW5nLndyaXRlVmFyVWludChlbmNvZGVyU3RhdGUsIG1lc3NhZ2VTeW5jKVxuICAgIHN5bmNQcm90b2NvbC53cml0ZVN5bmNTdGVwMihlbmNvZGVyU3RhdGUsIHRoaXMuZG9jKVxuICAgIGJjLnB1Ymxpc2godGhpcy5iY0NoYW5uZWwsIGVuY29kaW5nLnRvVWludDhBcnJheShlbmNvZGVyU3RhdGUpLCB0aGlzKVxuICAgIC8vIHdyaXRlIHF1ZXJ5QXdhcmVuZXNzXG4gICAgY29uc3QgZW5jb2RlckF3YXJlbmVzc1F1ZXJ5ID0gZW5jb2RpbmcuY3JlYXRlRW5jb2RlcigpXG4gICAgZW5jb2Rpbmcud3JpdGVWYXJVaW50KGVuY29kZXJBd2FyZW5lc3NRdWVyeSwgbWVzc2FnZVF1ZXJ5QXdhcmVuZXNzKVxuICAgIGJjLnB1Ymxpc2goXG4gICAgICB0aGlzLmJjQ2hhbm5lbCxcbiAgICAgIGVuY29kaW5nLnRvVWludDhBcnJheShlbmNvZGVyQXdhcmVuZXNzUXVlcnkpLFxuICAgICAgdGhpc1xuICAgIClcbiAgICAvLyBicm9hZGNhc3QgbG9jYWwgYXdhcmVuZXNzIHN0YXRlXG4gICAgY29uc3QgZW5jb2RlckF3YXJlbmVzc1N0YXRlID0gZW5jb2RpbmcuY3JlYXRlRW5jb2RlcigpXG4gICAgZW5jb2Rpbmcud3JpdGVWYXJVaW50KGVuY29kZXJBd2FyZW5lc3NTdGF0ZSwgbWVzc2FnZUF3YXJlbmVzcylcbiAgICBlbmNvZGluZy53cml0ZVZhclVpbnQ4QXJyYXkoXG4gICAgICBlbmNvZGVyQXdhcmVuZXNzU3RhdGUsXG4gICAgICBhd2FyZW5lc3NQcm90b2NvbC5lbmNvZGVBd2FyZW5lc3NVcGRhdGUodGhpcy5hd2FyZW5lc3MsIFtcbiAgICAgICAgdGhpcy5kb2MuY2xpZW50SURcbiAgICAgIF0pXG4gICAgKVxuICAgIGJjLnB1Ymxpc2goXG4gICAgICB0aGlzLmJjQ2hhbm5lbCxcbiAgICAgIGVuY29kaW5nLnRvVWludDhBcnJheShlbmNvZGVyQXdhcmVuZXNzU3RhdGUpLFxuICAgICAgdGhpc1xuICAgIClcbiAgfVxuXG4gIGRpc2Nvbm5lY3RCYyAoKSB7XG4gICAgLy8gYnJvYWRjYXN0IG1lc3NhZ2Ugd2l0aCBsb2NhbCBhd2FyZW5lc3Mgc3RhdGUgc2V0IHRvIG51bGwgKGluZGljYXRpbmcgZGlzY29ubmVjdClcbiAgICBjb25zdCBlbmNvZGVyID0gZW5jb2RpbmcuY3JlYXRlRW5jb2RlcigpXG4gICAgZW5jb2Rpbmcud3JpdGVWYXJVaW50KGVuY29kZXIsIG1lc3NhZ2VBd2FyZW5lc3MpXG4gICAgZW5jb2Rpbmcud3JpdGVWYXJVaW50OEFycmF5KFxuICAgICAgZW5jb2RlcixcbiAgICAgIGF3YXJlbmVzc1Byb3RvY29sLmVuY29kZUF3YXJlbmVzc1VwZGF0ZSh0aGlzLmF3YXJlbmVzcywgW1xuICAgICAgICB0aGlzLmRvYy5jbGllbnRJRFxuICAgICAgXSwgbmV3IE1hcCgpKVxuICAgIClcbiAgICBicm9hZGNhc3RNZXNzYWdlKHRoaXMsIGVuY29kaW5nLnRvVWludDhBcnJheShlbmNvZGVyKSlcbiAgICBpZiAodGhpcy5iY2Nvbm5lY3RlZCkge1xuICAgICAgYmMudW5zdWJzY3JpYmUodGhpcy5iY0NoYW5uZWwsIHRoaXMuX2JjU3Vic2NyaWJlcilcbiAgICAgIHRoaXMuYmNjb25uZWN0ZWQgPSBmYWxzZVxuICAgIH1cbiAgfVxuXG4gIGRpc2Nvbm5lY3QgKCkge1xuICAgIHRoaXMuc2hvdWxkQ29ubmVjdCA9IGZhbHNlXG4gICAgdGhpcy5kaXNjb25uZWN0QmMoKVxuICAgIGlmICh0aGlzLndzICE9PSBudWxsKSB7XG4gICAgICBjbG9zZVdlYnNvY2tldENvbm5lY3Rpb24odGhpcywgdGhpcy53cywgbnVsbClcbiAgICB9XG4gIH1cblxuICBjb25uZWN0ICgpIHtcbiAgICB0aGlzLnNob3VsZENvbm5lY3QgPSB0cnVlXG4gICAgaWYgKCF0aGlzLndzY29ubmVjdGVkICYmIHRoaXMud3MgPT09IG51bGwpIHtcbiAgICAgIHNldHVwV1ModGhpcylcbiAgICAgIHRoaXMuY29ubmVjdEJjKClcbiAgICB9XG4gIH1cbn1cbiJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(ssr)/./node_modules/y-websocket/src/y-websocket.js\n");

/***/ })

};
;